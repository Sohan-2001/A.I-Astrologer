{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Chirp Chat application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "displayName",
        "email"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single chat message.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ChatMessage entity."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ChatMessage) The ID of the user who sent the message."
        },
        "content": {
          "type": "string",
          "description": "The text content of the message."
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "senderId",
        "content",
        "timestamp"
      ]
    },
    "OccurrencesPrediction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OccurrencesPrediction",
      "type": "object",
      "description": "Represents a prediction of important occurrences based on B.V. Raman Ayanamsa.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the OccurrencesPrediction entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N OccurrencesPrediction) The ID of the user for whom the prediction is made."
        },
        "predictionText": {
          "type": "string",
          "description": "The text content of the prediction."
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time the prediction was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "predictionText",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership enforces that only the user can access their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores all chat messages. Security rules will need to ensure that only authenticated users can create messages. Reading messages would require additional context (e.g., a chat room or direct message relationship).",
          "params": [
            {
              "name": "messageId",
              "description": "The unique identifier of the chat message."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/predictions/{predictionId}",
        "definition": {
          "entityName": "OccurrencesPrediction",
          "schema": {
            "$ref": "#/backend/entities/OccurrencesPrediction"
          },
          "description": "Stores astrological predictions for each user. Path-based ownership enforces that only the user can access their own prediction data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "predictionId",
              "description": "The unique identifier of the prediction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Chirp Chat application, focusing on user data, chat messages, and astrological prediction features. It prioritizes security, scalability, and ease of debugging, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and Rules are not Filters (QAPs). \n\nAuthorization Independence is achieved by using path-based ownership for user-specific data (users/{userId}/...), eliminating the need for `get()` calls in security rules to validate ownership. This is crucial for atomic operations and simplifies debugging.\n\nStructural Segregation is enforced by separating user data, messages, and predictions into distinct collections or subcollections. This ensures that documents within a collection share the same security requirements, making rules simpler and more maintainable.\n\nAccess Modeling is standardized with path-based ownership for private user data and predictions. Chat messages could potentially involve more complex collaboration scenarios, which could be handled with Membership Maps if group chats are added in the future (currently not explicitly requested).\n\nQAPs are addressed by the structural segregation. Listing messages or predictions is secure because the structure ensures that users can only access resources they own or are explicitly authorized to view. This is a key aspect of preventing data leakage and ensuring that security rules don't act as filters.\n\nSpecifically, OccurrencesPredictions are stored in subcollections under each user document (`/users/{userId}/predictions/{predictionId}`). This enforces path-based ownership: only the user who owns the document can read or write to it. Chat messages are stored in a flat collection for simplicity, with the senderId included in each message document. This allows for basic sender-based authorization."
  }
}